<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Contrat — Orvanta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Contrat de service Orvanta" />
  <link rel="stylesheet" href="../styles.css" />
  <link rel="stylesheet" href="styles.css" />

  <link rel="apple-touch-icon" sizes="180x180" href="../favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon_io/favicon-16x16.png">
  <link rel="manifest" href="../favicon_io/site.webmanifest">
</head>

<body>

  <!-- Header (Hidden on Print) -->
  <header class="no-print">
    <nav class="nav">
      <div class="brand">Orvanta</div>
      <div class="nav-links">
        <a href="../index.html">Accueil</a>
      </div>
    </nav>
  </header>

  <div class="contract-container">
    <!-- Logo and Header Row -->
    <div class="contract-top">
      <div class="contract-logo">
        <img src="../logo.png" alt="Orvanta Logo" />
      </div>

      <div class="contract-header">
        <h1>Entente de Services – Recherche et Recouvrement d'Actifs</h1>
        <div id="clientInfo">
          <p class="client-name">Client : <span id="clientName">Chargement...</span></p>
          <p class="contract-date">Date : <span id="currentDate">Chargement...</span></p>
          <p class="contract-status">Statut : <span id="contractStatus" class="status-badge">Chargement...</span></p>
        </div>
        <p class="provider-name">Fournisseur : Orvanta</p>
        <p class="provider-description">Entreprise spécialisée en localisation, vérification et recouvrement d'actifs financiers</p>
      </div>
    </div>

    <!-- Contract Body -->
    <div class="contract-body">
      <section class="contract-section">
        <h2>1. Objet de l'Entente</h2>
        <p>
          La présente entente définit les termes et conditions selon lesquels Orvanta fournit au Client des services professionnels de recherche, d'identification, de documentation et de recouvrement d'actifs financiers, incluant notamment :
        </p>
        <ul>
          <li>Recherche d'actifs perdus, retenus, dormants ou non réclamés</li>
          <li>Vérification de la légitimité des droits du Client</li>
          <li>Analyse documentaire et administrative</li>
          <li>Démarches auprès de tiers (institutions, intermédiaires, détenteurs d'actifs)</li>
          <li>Accompagnement stratégique jusqu'au recouvrement effectif, lorsque possible</li>
        </ul>
        <p>
          Les services sont fournis exclusivement au bénéfice du Client et dans le respect des lois applicables.
        </p>
      </section>

      <section class="contract-section">
        <h2>2. Nature du Mandat – Engagement Ferme</h2>
        <p>
          Le Client reconnaît que les services fournis par Orvanta sont personnalisés, nécessitent des recherches approfondies et une mobilisation immédiate de ressources.
        </p>
        <ul>
          <li>La création du mandat constitue une acceptation ferme et irrévocable de la présente entente.</li>
          <li>Aucun remboursement ne pourra être exigé une fois les démarches entamées, sauf en cas de manquement grave et démontré de la part d'Orvanta.</li>
        </ul>
      </section>

      <section class="contract-section">
        <h2>3. Honoraires, Paiement et Modalités</h2>
        <p>Sauf indication contraire écrite :</p>
        <ul>
          <li>Les honoraires d'Orvanta sont exigibles uniquement en cas de recouvrement effectif</li>
          <li>Les frais de service correspondent à 10 % du montant récupéré ou 100 $, selon le montant le plus élevé</li>
          <li>Les honoraires sont déduits directement des sommes récupérées ou exigibles avant la remise des fonds</li>
          <li>Aucun paiement n'est requis si aucun actif n'est récupéré.</li>
        </ul>
      </section>

      <section class="contract-section">
        <h2>4. Obligation de Moyens – Absence de Garantie de Résultat</h2>
        <p>
          Orvanta s'engage à déployer tous les moyens raisonnables, conformément aux pratiques professionnelles reconnues.
        </p>
        <p>
          Toutefois, le Client reconnaît expressément que :
        </p>
        <ul>
          <li>Le recouvrement dépend de facteurs externes (tiers, délais, cadres juridiques)</li>
          <li>Aucun résultat spécifique n'est garanti</li>
          <li>L'absence de recouvrement ne constitue pas une faute et ne donne droit à aucune indemnité</li>
        </ul>
      </section>

      <section class="contract-section">
        <h2>5. Collaboration du Client</h2>
        <p>Le Client s'engage à :</p>
        <ul>
          <li>Fournir des informations exactes, complètes et à jour</li>
          <li>Coopérer dans les délais requis</li>
          <li>Fournir toute documentation nécessaire à la validation du dossier</li>
        </ul>
        <p>
          Tout retard ou omission imputable au Client ne saurait engager la responsabilité d'Orvanta.
        </p>
      </section>

      <section class="contract-section">
        <h2>6. Limitations Techniques, Juridiques et Tiers</h2>
        <p>Certaines démarches peuvent être limitées ou impossibles en raison :</p>
        <ul>
          <li>De cadres légaux ou réglementaires</li>
          <li>De refus ou délais de la part de tiers</li>
          <li>De prescriptions, clôtures ou restrictions institutionnelles</li>
        </ul>
        <p>
          Orvanta ne saurait être tenue responsable des décisions, délais ou refus émanant de tiers.
        </p>
      </section>

      <section class="contract-section">
        <h2>7. Confidentialité et Discrétion</h2>
        <p>
          Orvanta est tenue à une obligation stricte de confidentialité concernant toutes les informations du Client.
        </p>
        <p>
          Le Client s'engage également à ne pas porter atteinte à la réputation d'Orvanta.
          Cette obligation est réciproque et sans limitation de durée.
        </p>
      </section>

      <section class="contract-section">
        <h2>8. Propriété Intellectuelle et Méthodes</h2>
        <p>
          L'ensemble des méthodes, outils, processus et documents développés par Orvanta demeure sa propriété exclusive, sauf accord écrit contraire.
        </p>
        <p>
          Le Client bénéficie d'un droit d'utilisation strictement limité à l'exécution du présent mandat.
        </p>
      </section>

      <section class="contract-section">
        <h2>9. Résiliation Anticipée</h2>
        <p>En cas de résiliation par le Client :</p>
        <ul>
          <li>Orvanta se réserve le droit de facturer toute démarche déjà engagée</li>
          <li>Aucun remboursement ne pourra être exigé pour les travaux effectués</li>
        </ul>
        <p>
          Orvanta peut mettre fin au mandat en cas de fausse déclaration ou de non-coopération du Client.
        </p>
      </section>

      <section class="contract-section">
        <h2>10. Limitation de Responsabilité</h2>
        <p>
          La responsabilité d'Orvanta est strictement limitée aux honoraires effectivement perçus.
        </p>
        <p>Orvanta ne saurait être tenue responsable de :</p>
        <ul>
          <li>Pertes financières indirectes</li>
          <li>Manque à gagner</li>
          <li>Décisions de tiers</li>
          <li>Préjudices indirects ou consécutifs</li>
        </ul>
      </section>

      <section class="contract-section">
        <h2>11. Force Majeure</h2>
        <p>
          Aucune des parties ne pourra être tenue responsable en cas de force majeure, incluant notamment : catastrophes naturelles, conflits, cyberattaques, interruptions de services tiers ou décisions gouvernementales.
        </p>
      </section>

      <section class="contract-section">
        <h2>12. Divisibilité</h2>
        <p>
          Si une clause est jugée invalide, les autres dispositions demeurent pleinement en vigueur.
          La clause invalide sera remplacée par une disposition conforme à l'intention initiale.
        </p>
      </section>

      <section class="contract-section">
        <h2>13. Droit Applicable et Juridiction</h2>
        <p>
          La présente entente est régie par les lois applicables dans la juridiction d'opération d'Orvanta.
          Tout litige sera soumis aux tribunaux compétents.
        </p>
      </section>

      <section class="contract-section">
        <h2>14. Acceptation</h2>
        <p>
          En créant un mandat avec Orvanta, le Client reconnaît avoir lu, compris et accepté sans réserve l'ensemble des présentes clauses.
        </p>
      </section>

      <!-- Financial Summary Section -->
      <section class="contract-section financial-section" id="financialSection" style="display: none;">
        <h2>Résumé des Actifs</h2>
        <div class="assets-summary">
          <div class="assets-row">
            <span class="assets-label">Valeur totale des actifs :</span>
            <span class="assets-value" id="totalAssets">0.00 $</span>
          </div>
          <div class="assets-row">
            <span class="assets-label">Frais de service Orvanta (10% ou 100 $, selon le plus élevé) :</span>
            <span class="assets-value" id="feeAmount">0.00 $</span>
          </div>
          <div class="assets-row assets-total">
            <span class="assets-label"><strong>Montant net à recevoir :</strong></span>
            <span class="assets-value"><strong id="netAmount">0.00 $</strong></span>
          </div>
        </div>
      </section>

      <section class="contract-section signature-section" id="signatureSection" style="display: none;">
        <!-- Client Signature -->
        <div class="signature-display-block">
          <h3>Signature du Client</h3>
          <div id="signatureDisplay" class="signature-display">
            <p class="loading-text">Chargement de la signature...</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Print Button (Hidden on Print) -->
    <div class="print-button-container no-print">
      <button onclick="window.print()" class="print-button">Imprimer / Exporter PDF</button>
    </div>
  </div>

  <script>
    // Get UUID from URL parameter
    function getUuidFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('uuid');
    }

    // Fetch contract data from endpoint
    async function loadContractData() {
      const uuid = getUuidFromUrl();

      // If no UUID, show non-personalized version
      if (!uuid) {
        document.getElementById('clientInfo').style.display = 'none';
        document.getElementById('signatureSection').style.display = 'none';
        document.getElementById('financialSection').style.display = 'none';
        return;
      }

      try {
        const response = await fetch(`https://n8n.orvanta.ca/webhook/contrat?uuid=${uuid}`);
        const data = await response.json();

        // Assuming the endpoint returns an array, get the first item
        const contractData = Array.isArray(data) ? data[0] : data;

        // Show client info section
        document.getElementById('clientInfo').style.display = 'block';

        // Set the client name
        if (contractData.prenom && contractData.nom) {
          const clientNameElement = document.getElementById('clientName');
          clientNameElement.textContent = `${contractData.prenom} ${contractData.nom}`;
        }

        // Set the date from the API
        if (contractData.received_at) {
          const dateElement = document.getElementById('currentDate');
          const date = new Date(contractData.received_at);
          const options = { year: 'numeric', month: 'long', day: 'numeric' };
          dateElement.textContent = date.toLocaleDateString('fr-CA', options);
        }

        // Set the status
        if (contractData.status) {
          const statusElement = document.getElementById('contractStatus');
          const statusText = getStatusText(contractData.status);
          statusElement.textContent = statusText;
          statusElement.className = 'status-badge status-' + contractData.status;
        }

        // Display the signature
        if (contractData.signature_base64) {
          const signatureDisplay = document.getElementById('signatureDisplay');
          const img = document.createElement('img');
          img.src = 'data:image/png;base64,' + contractData.signature_base64;
          img.alt = 'Signature du client';
          img.className = 'signature-image';
          signatureDisplay.innerHTML = '';
          signatureDisplay.appendChild(img);

          // Show signature section
          document.getElementById('signatureSection').style.display = 'block';
        }

        // Calculate and display financial summary
        if (contractData.valeur && Array.isArray(contractData.valeur)) {
          const totalAssets = contractData.valeur.reduce((sum, val) => sum + (parseFloat(val) || 0), 0);
          const fee = Math.max(totalAssets * 0.10, 100);
          const netAmount = Math.max(0, totalAssets - fee); // Ensure non-negative

          // Update the financial section
          document.getElementById('totalAssets').textContent = totalAssets.toFixed(2) + ' $';
          document.getElementById('feeAmount').textContent = fee.toFixed(2) + ' $';
          document.getElementById('netAmount').textContent = netAmount.toFixed(2) + ' $';

          // Show the financial section
          document.getElementById('financialSection').style.display = 'block';
        }

      } catch (error) {
        console.error('Erreur lors du chargement des données du contrat:', error);

        // Fallback to current date if API fails
        const dateElement = document.getElementById('currentDate');
        const today = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        dateElement.textContent = today.toLocaleDateString('fr-CA', options);

        document.getElementById('clientName').textContent = 'Non disponible';
        document.getElementById('contractStatus').textContent = 'Non disponible';
        document.getElementById('signatureDisplay').innerHTML = '<p class="error-text">Signature non disponible</p>';
      }
    }

    // Convert status to French
    function getStatusText(status) {
      const statusMap = {
        'new': 'En processus',
        'pending': 'En attente',
        'approved': 'Approuvé',
        'completed': 'Complété',
        'cancelled': 'Annulé'
      };
      return statusMap[status] || status;
    }

    // Load data when page loads
    loadContractData();
  </script>

</body>
</html>
